<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Fly Movie Format - User's Guide for Braid and Strand Camera</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Low latency image processing and tracking">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="braid-and-strand-camera.html">Braid and Strand Camera</a></li><li class="chapter-item expanded "><a href="hardware-selection.html"><strong aria-hidden="true">1.</strong> Hardware selection</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="braidz-files.html"><strong aria-hidden="true">3.</strong> BRAIDZ files and Analysis Scripts</a></li><li class="chapter-item expanded "><a href="braid_3d_tracking.html"><strong aria-hidden="true">4.</strong> Braid: 3D Tracking</a></li><li class="chapter-item expanded "><a href="parameters_for_object_detection_and_tracking.html"><strong aria-hidden="true">5.</strong> Parameters for Object Detection and Tracking</a></li><li class="chapter-item expanded "><a href="braid_calibration.html"><strong aria-hidden="true">6.</strong> Braid: 3D Calibration</a></li><li class="chapter-item expanded "><a href="braid_remote_cameras.html"><strong aria-hidden="true">7.</strong> Braid: Remote cameras</a></li><li class="chapter-item expanded "><a href="scripting-with-python.html"><strong aria-hidden="true">8.</strong> Scripting with Python</a></li><li class="chapter-item expanded "><a href="processing-saved-videos.html"><strong aria-hidden="true">9.</strong> Processing saved videos</a></li><li class="chapter-item expanded "><a href="fmf_format.html" class="active"><strong aria-hidden="true">10.</strong> Fly Movie Format</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">11.</strong> Troubleshooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">User's Guide for Braid and Strand Camera</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/strawlab/strand-braid" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#fmf-fly-movie-format---simple-uncompressed-movie-storage-format" id="fmf-fly-movie-format---simple-uncompressed-movie-storage-format">FMF (Fly Movie Format) - simple, uncompressed movie storage format</a></h1>
<p>The primary design goals of FMF files are:</p>
<ul>
<li>Single pass, low CPU overhead writing of lossless movies for realtime streaming applications</li>
<li>Precise timestamping for correlation with other activities</li>
<li>Simple format that can be written and read from a variety of languages.</li>
</ul>
<p>These goals are achieved via using a very simple format. After an initial header
containing meta-data such as image size and color coding scheme (e.g.
monochromatic 8 bits per pixel, YUV422, etc.), repeated chunks of raw image data
and timestamp are saved. Because the raw image data from the native camera
driver is saved, no additional processing is performed. Thus, streaming of
movies from camera to disk will keep the CPU free for other tasks, but it will
require a lot of disk space. Furthermore, the disk bandwidth required is
equivalent to the camera bandwidth (unless you save only a region of the images,
or if you only save a fraction of the incoming frames).</p>
<p>The FMF file type defines raw image sequences where each image is stored exactly
in the raw data bytes as they were acquired from the camera together with with a
timestamp. There are two versions implemented, versions 1 and 3 (Version 2 was
briefly used internally and is now best forgotten). Version 1 is deprecated and
new movies should not be written in this format.</p>
<p>A <strong>Rust</strong> implementation to read and write <code>.fmf</code> files can be found in the
<a href="https://github.com/strawlab/strand-braid/tree/main/fmf"><code>github.com/strawlab/strand-braid</code>
repository</a>.</p>
<p>Documentation for the file type and reading/writing <code>.fmf</code> files in <strong>Python</strong>
can be found at the <a href="http://code.astraw.com/projects/motmot/fly-movie-format.html">documentation of
<code>motmot.FlyMovieFormat</code></a>.</p>
<p>A <strong>MATLAB®</strong> implementation can be found in the
<a href="https://github.com/motmot/flymovieformat/tree/master/matlab"><code>github.com/motmot/flymovieformat</code>
repository</a>.</p>
<p>An <strong>R</strong> implementation can be found in the <a href="https://github.com/jefferis/fmfio"><code>github.com/jefferis/fmfio</code>
repository</a>.</p>
<h2><a class="header" href="#converting-movies-to-and-from-fmf-format-with-the-fmf-command-line-program" id="converting-movies-to-and-from-fmf-format-with-the-fmf-command-line-program">Converting movies to and from FMF format with the <code>fmf</code> command line program</a></h2>
<p>The <code>fmf</code> command line program from
<a href="https://github.com/strawlab/strand-braid/tree/main/fmf/fmf-cli">https://github.com/strawlab/strand-braid/tree/main/fmf/fmf-cli</a>
can be used for a variety of tasks with <code>.fmf</code> files, especially converting to
and from other formats.</p>
<p>Here is the output <code>fmf --help</code>:</p>
<pre><code>strawlab@flycube10:~$
fmf 0.1.0
work with .fmf (fly movie format) files

USAGE:
    fmf &lt;SUBCOMMAND&gt;

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

SUBCOMMANDS:
    export-fmf       export an fmf file
    export-jpeg      export a sequence of jpeg images
    export-mkv       export to mkv
    export-png       export a sequence of png images
    export-y4m       export to y4m (YUV4MPEG2) format
    help             Prints this message or the help of the given subcommand(s)
    import-images    import a sequence of images, converting it to an FMF file
    import-webm      import a webm file, converting it to an FMF file
    info             print information about an fmf file
</code></pre>
<p>See https://github.com/strawlab/strand-braid/tree/main/fmf/fmf-cli for more information.</p>
<h2><a class="header" href="#file-structure" id="file-structure">File Structure</a></h2>
<table><thead><tr><th>FMF File structure</th></tr></thead><tbody>
<tr><td>Header</td></tr>
<tr><td>Frame chunk 0</td></tr>
<tr><td>Frame chunk 1</td></tr>
<tr><td>Frame chunk 2</td></tr>
<tr><td>...</td></tr>
<tr><td>Frame chunk N</td></tr>
</tbody></table>
<p>The chunk size is specified in the header and is equal to the raw frame pixel
data size plus 8 bytes for the timestamp. Thus a 640 pixel wide, 480 pixel high
MONO8 format image would have a <code>chunksize</code> of 307208 (equal to 640 * 480 + 8).</p>
<p>Because the chunk size is constant for all frames, any chunk can be accessed by
computing its position and seeking to that location. For the same reason, the
image data within FMF files can be memory mapped.</p>
<h3><a class="header" href="#header-version-3" id="header-version-3">Header Version 3</a></h3>
<p>This is the preferred header for all new FMF files.</p>
<table><thead><tr><th>Start position</th><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>u32</td><td>version</td><td>Version number (3)</td></tr>
<tr><td>4</td><td>u32</td><td>lenformat</td><td>Length of the subsequent format string</td></tr>
<tr><td>8</td><td>[u8; N]</td><td>format</td><td>ASCII string of N characters containing pixel format, e.g. <code>MONO8</code> or <code>YUV422</code></td></tr>
<tr><td>8+N</td><td>u32</td><td>bpp</td><td>Bits per pixel, e.g. 8</td></tr>
<tr><td>12+N</td><td>u32</td><td>height</td><td>Number of rows of image data</td></tr>
<tr><td>16+N</td><td>u32</td><td>width</td><td>Number of columns of image data</td></tr>
<tr><td>20+N</td><td>u64</td><td>chunksize</td><td>Bytes per &quot;chunk&quot; (timestamp + frame)</td></tr>
<tr><td>28+N</td><td>u64</td><td>n_frames</td><td>Number of frame chunks (0=unknown, read file to find out)</td></tr>
</tbody></table>
<p>For the <code>format</code> field, the following pixel formats are known:</p>
<table><thead><tr><th>Format string</th><th>Description</th></tr></thead><tbody>
<tr><td><code>MONO8</code></td><td>Monochrome data, 8 bits per pixel</td></tr>
<tr><td><code>RAW8:RGGB</code></td><td>Raw Bayer mosaic data, RGGB pattern, 8 bits per pixel</td></tr>
<tr><td><code>RAW8:GBRG</code></td><td>Raw Bayer mosaic data, GBRG pattern, 8 bits per pixel</td></tr>
<tr><td><code>RAW8:GRBG</code></td><td>Raw Bayer mosaic data, GRBG pattern, 8 bits per pixel</td></tr>
<tr><td><code>RAW8:BGGR</code></td><td>Raw Bayer mosaic data, BGGR pattern, 8 bits per pixel</td></tr>
<tr><td><code>YUV422</code></td><td>Packed YUV encoded data, 16 bits per pixel</td></tr>
<tr><td><code>RGB8</code></td><td>Packed RGB encoded data, 24 bits per pixel</td></tr>
</tbody></table>
<p>This list of pixel formats is not exhaustive and other formats can be added.</p>
<h3><a class="header" href="#header-version-1" id="header-version-1">Header Version 1</a></h3>
<p>⚠ This version is deprecated and no new files with this format should be written. ⚠</p>
<p>Only supports MONO8 pixel format.</p>
<table><thead><tr><th>Start position</th><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>u32</td><td>version</td><td>Version number (1)</td></tr>
<tr><td>4</td><td>u32</td><td>height</td><td>Number of rows of image data</td></tr>
<tr><td>8</td><td>u32</td><td>width</td><td>Number of columns of image data</td></tr>
<tr><td>12</td><td>u64</td><td>chunksize</td><td>Bytes per &quot;chunk&quot; (timestamp + frame)</td></tr>
<tr><td>20</td><td>u64</td><td>n_frames</td><td>Number of frames (0=unknown, read file to find out)</td></tr>
</tbody></table>
<h3><a class="header" href="#frame-chunks" id="frame-chunks">Frame Chunks</a></h3>
<p>Frame chunks have an identical format in FMF v1 and v3 files. From a given
camera pixel format and size, they are constant in size and thus the Nth frame
can be accessed by seeking to <code>frame0_offset + n*chunksize</code>. The image data is
uncompressed raw image data as read directly from the camera.</p>
<table><thead><tr><th>Start position within chunk</th><th>Type</th><th>Name</th><th>Description</th></tr></thead><tbody>
<tr><td>0</td><td>f64</td><td>timestamp</td><td>Timestamp (seconds in current epoch)</td></tr>
<tr><td>8</td><td>[u8; N]</td><td>image_data</td><td>Image data</td></tr>
</tbody></table>
<h3><a class="header" href="#types-used-above" id="types-used-above">Types used above</a></h3>
<p>All numbers are little-endian (Intel standard).</p>
<table><thead><tr><th>Type</th><th>size (in bytes)</th><th>description</th></tr></thead><tbody>
<tr><td>[u8; N]</td><td>N</td><td>variable length buffer of characters</td></tr>
<tr><td>u32</td><td>4</td><td>unsigned 32 bit integer</td></tr>
<tr><td>u64</td><td>8</td><td>unsigned 64 bit integer</td></tr>
<tr><td>f64</td><td>8</td><td>64 bit floating point number</td></tr>
</tbody></table>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="processing-saved-videos.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="troubleshooting.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="processing-saved-videos.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="troubleshooting.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
